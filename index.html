<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pisk Pro üéß</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            background: #6200ee;
            color: white;
            border: none;
            border-radius: 8px;
            margin: 10px;
            cursor: pointer;
        }
        #status {
            font-weight: bold;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>Pisk Pro üéß</h1>
    <button id="startBtn">üé§ –í–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω</button>
    <button id="stopBtn" disabled>üî¥ –í—ã–∫–ª—é—á–∏—Ç—å</button>
    <div id="status">–°—Ç–∞—Ç—É—Å: –º–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω</div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusEl = document.getElementById('status');
        
        // –ê—É–¥–∏–æ-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let audioContext;
        let microphone;
        let isActive = false;

        // –í–∫–ª—é—á–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
        async function startMicrophone() {
            try {
                // –°–æ–∑–¥–∞—ë–º –∞—É–¥–∏–æ–∫–æ–Ω—Ç–µ–∫—Å—Ç
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ (–í–ê–ñ–ù–û: –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏)
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true 
                });
                
                // –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–∞–ø—Ä—è–º—É—é –∫ –≤—ã—Ö–æ–¥—É
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(audioContext.destination);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                startBtn.disabled = true;
                stopBtn.disabled = false;
                statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –º–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω';
                isActive = true;
                
                console.log("–ó–≤—É–∫ –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ –≤ –Ω–∞—É—à–Ω–∏–∫–∏!");

            } catch (error) {
                statusEl.textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                console.error("–û—à–∏–±–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞:", error);
            }
        }

        // –í—ã–∫–ª—é—á–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
        function stopMicrophone() {
            if (microphone) {
                microphone.disconnect();
                if (audioContext.state !== 'closed') {
                    audioContext.close();
                }
                startBtn.disabled = false;
                stopBtn.disabled = true;
                statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –º–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω';
                isActive = false;
            }
        }

        // –ö–Ω–æ–ø–∫–∏
        startBtn.addEventListener('click', startMicrophone);
        stopBtn.addEventListener('click', stopMicrophone);

        // –ê–≤—Ç–æ–≤—ã–∫–ª—é—á–µ–Ω–∏–µ
        window.addEventListener('beforeunload', stopMicrophone);
    </script>
</body>
</html>
